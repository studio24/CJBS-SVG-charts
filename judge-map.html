<!DOCTYPE html>
<html>
<head>
    <title>Test SVG</title>
    <script src="/js/d3.min.js"></script>
    <script src="/js/topojson.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <style>

        *, *:before, *:after {
            -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box;
         }

         .map {
            fill: #ccc;
         }

        .point,.arrow{
            fill: #e6228d;
            cursor: pointer;
        }




    </style>
</head>
<body>
    <div class="svg-container"></div>
    <p></p>

    <script>
        var width = 2000;
        var height = 1000;
        var svg = d3.select('.svg-container')
                    .append('svg')
                    .attr('width', width)
                    .attr('height', height);

        var projection = d3.geo.mercator()
                               .translate([width / 2, height / 2])
                               .scale((width + 1) / 2 / Math.PI)
                               .center([0,50]);
        var path = d3.geo.path()
                         .projection(projection);

        d3.json('world.json', function (json) {
            svg.append('path')
               .datum(topojson.feature(json, json.objects.land))
               .attr('class', 'map')
               .attr('d', path);

            d3.csv('judge-map-data.csv', function (data) {
                svg.selectAll('path')
                   .data(data)
                   .enter()
                   .append('path')
                   .attr('class', 'point')
                   .attr('d', 'M130,19.321C130,8.65,121.337,0,110.651,0S91.301,8.65,91.301,19.321c0,9.365,6.674,17.169,15.531,18.94 l3.805,3.799l3.8-3.794C123.31,36.507,130,28.696,130,19.321z')
                   .attr('transform', function(d){
                      return 'translate(' + (projection([d.lon, d.lat])[0]-42) + ', ' + (projection([d.lon, d.lat])[1]-42) + ')';
                   })
                   .attr('fill', '#E12B88')
                   .on('mouseover', function (d, i) {
                       d3.select((this))
                         .transition(500)
                         .attr('transform', function (d) {
                             cx = projection([d.lon, d.lat])[0] * 3;
                             cy = projection([d.lon, d.lat])[1] * 3;
                             return 'translate(' + -cx + ', ' + (-cy -20) + ') scale(4)';
                         });
                           // svg.append('defs')
                           // .append('marker')
                           // .attr('refX', 6+3)
                           // .attr('refY', 2)
                           // .attr('markerWidth', 200)
                           // .attr('markerHeight', )
                           // .attr('orient', 'auto')
                           // .style('fill', 'black')
                           // .append('path')
                           // .attr('d', 'M 0,0 V 4 L6,2 Z');
                   })
                   .on('mouseout', function (d, i) {
                       d3.select((this))
                         .transition()
                         .attr('transform', 'translate(0,0) scale(1)');
                   })
                   .on('click', function (d) {
                       d3.select((this))
                         .transition()
                         .attr('transform', function (d) {
                             cx = projection([d.lon, d.lat])[0] * 9;
                             cy = projection([d.lon, d.lat])[1] * 9;
                             return 'translate(' + -cx + ', ' + (-cy -50) + ') scale(10)';
                       });
                       d3.select('p')
                         .html('There are ' + d.delegates + ' delegate(s) from ' + d.place + '.');
                   });
            });


        });
    </script>
</body>
</html>